<!-- =========================
FILE: index.html
========================= -->
<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>WhatsApp Chat Game</title>

<style>
  :root{
    --wa-green:#008069;
    --bg:#efeae2;
    --line:#e9e9e9;
    --me:#d9fdd3;
    --you:#ffffff;
    --text:#111;
    --muted:#6b6b6b;
    --tick:#667781;
    --tickRead:#53bdeb;
    --chip:#eaf5ff;
    --chipText:#1e6aa6;
    --danger:#e74c3c;
    --shadow:0 12px 28px rgba(0,0,0,.16);
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);display:flex;justify-content:center}
  .app{width:100%;max-width:430px;height:100vh;background:var(--bg);display:flex;flex-direction:column;position:relative;overflow:hidden}

  .header{
    background:var(--wa-green);
    color:#fff;
    padding:10px 12px;
    display:flex;align-items:center;gap:10px;
    position:relative;z-index:10;
  }
  .back{
    width:34px;height:34px;border-radius:999px;border:0;background:rgba(255,255,255,.14);
    color:#fff;font-size:18px;font-weight:900;cursor:pointer;display:none;
  }
  .titlewrap{display:flex;align-items:center;gap:10px;min-width:0;flex:1}
  .avatar{
    width:38px;height:38px;border-radius:999px;object-fit:cover;
    border:2px solid rgba(255,255,255,.3);
    background:rgba(255,255,255,.14);
    flex:0 0 auto;
  }
  .ttext{display:flex;flex-direction:column;min-width:0}
  .name{font-weight:900;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .status{font-size:12px;opacity:.9;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

  /* Toasts */
  .toastWrap{
    position:fixed;top:10px;left:50%;transform:translateX(-50%);
    width:min(420px, calc(100% - 18px));
    z-index:9999;display:flex;flex-direction:column;gap:8px;pointer-events:none;
  }
  .toast{
    background:rgba(255,255,255,.92);
    border:1px solid rgba(0,0,0,.08);
    border-radius:18px;
    padding:10px 12px;
    box-shadow:var(--shadow);
    animation: toastIn .22s ease both;
    backdrop-filter: blur(10px);
  }
  .toastTop{display:flex;align-items:center;justify-content:space-between;font-size:12px;opacity:.75;margin-bottom:6px}
  .toastTop .appname{display:flex;align-items:center;gap:8px;font-weight:900}
  .waIcon{width:18px;height:18px;border-radius:6px;background:#25d366;display:inline-grid;place-items:center;color:#fff;font-size:12px;font-weight:950}
  .toastMain{display:flex;gap:10px;align-items:flex-start}
  .toastAva{width:30px;height:30px;border-radius:999px;background:#dfe7e5;display:grid;place-items:center;font-weight:900;color:#234;flex:0 0 auto}
  .toastMeta{min-width:0}
  .toastName{font-weight:950;font-size:13px;line-height:1.1}
  .toastMsg{font-size:13px;opacity:.85;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:3px}
  .toast.out{animation: toastOut .25s ease both}
  @keyframes toastIn{from{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}
  @keyframes toastOut{from{opacity:1;transform:translateY(0)}to{opacity:0;transform:translateY(-8px)}}

  /* Screens */
  .screen{flex:1;display:none;overflow:hidden}
  .screen.active{display:flex;flex-direction:column}

  /* Chat list */
  .list{background:#fff;flex:1;overflow:auto}
  .row{display:flex;gap:12px;align-items:center;padding:12px;border-bottom:1px solid var(--line);cursor:pointer}
  .row:hover{background:#fafafa}
  .row .ava{
    width:46px;height:46px;border-radius:999px;object-fit:cover;flex:0 0 auto;
    background:#dfe7e5;display:grid;place-items:center;font-weight:900;color:#234;
  }
  .row .meta{min-width:0;flex:1}
  .row .meta .rname{font-weight:900}
  .row .meta .prev{opacity:.7;font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:2px;min-height:18px}
  .row .time{font-size:12px;opacity:.6;flex:0 0 auto}

  /* Chat area */
  .chatArea{flex:1;overflow:hidden;display:flex;flex-direction:column;background:var(--bg)}
  .chat{flex:1;padding:12px 10px;overflow-y:auto;display:flex;flex-direction:column;gap:10px}

  /* Bubbles */
  .bubble{
    max-width:78%;
    padding:10px 12px 6px 12px;
    border-radius:14px;
    font-size:14px;
    color:var(--text);
    position:relative;
    box-shadow:0 1px 2px rgba(0,0,0,.08);
  }
  .you{background:var(--you);align-self:flex-start;border-top-left-radius:8px}
  .me{background:var(--me);align-self:flex-end;border-top-right-radius:8px}
  .you::before{
    content:"";position:absolute;left:-6px;top:0;width:12px;height:12px;background:var(--you);
    clip-path: polygon(100% 0, 0 0, 100% 100%);filter:drop-shadow(-1px 1px 0 rgba(0,0,0,.06));
  }
  .me::after{
    content:"";position:absolute;right:-6px;top:0;width:12px;height:12px;background:var(--me);
    clip-path: polygon(0 0, 100% 0, 0 100%);filter:drop-shadow(1px 1px 0 rgba(0,0,0,.06));
  }
  .metaLine{
    margin-top:6px;display:flex;justify-content:flex-end;gap:6px;align-items:center;
    font-size:11px;color:var(--muted);user-select:none;
  }
  .ticks{font-weight:900;color:var(--tick);letter-spacing:-2px}
  .ticks.read{color:var(--tickRead)}
  .ticks span{display:inline-block;transform:translateY(-.3px)}
  .ticks span + span{margin-left:-2px}

  /* Chips */
  .chips{
    padding:8px 10px;display:flex;gap:8px;flex-wrap:wrap;
    background:rgba(255,255,255,.75);
    border-top:1px solid rgba(0,0,0,.06);
    backdrop-filter: blur(6px);
  }
  .chip{
    border:1px solid rgba(0,0,0,.08);
    background:var(--chip);
    color:var(--chipText);
    font-weight:900;
    border-radius:999px;
    padding:9px 12px;
    cursor:pointer;
    transition:transform .12s ease, filter .12s ease;
  }
  .chip:hover{transform:translateY(-1px);filter:brightness(1.03)}
  .chip:active{transform:scale(.98)}
  .chip.danger{
    background:#ffecec;color:#b21f2d;border-color:rgba(178,31,45,.18);
  }

  /* Input bar */
  .inputBar{
    padding:10px 10px calc(10px + env(safe-area-inset-bottom));
    display:flex;gap:8px;align-items:flex-end;
    background:rgba(255,255,255,.88);
    border-top:1px solid rgba(0,0,0,.06);
    backdrop-filter: blur(8px);
  }
  .roundBtn{
    width:40px;height:40px;border-radius:999px;border:0;background:#fff;
    box-shadow:0 2px 10px rgba(0,0,0,.08);
    cursor:pointer;display:grid;place-items:center;color:#4a4a4a;font-weight:950;
  }
  .composer{
    flex:1;background:#fff;border-radius:22px;padding:10px 12px;
    box-shadow:0 2px 10px rgba(0,0,0,.08);
    border:1px solid rgba(0,0,0,.06);
    min-height:40px;display:flex;align-items:center;
  }
  .composer input{width:100%;border:0;outline:0;font-size:14px;background:transparent}
  .send{
    width:44px;height:44px;border-radius:999px;border:0;
    background:var(--wa-green);
    color:#fff;font-weight:950;cursor:pointer;
    box-shadow:0 8px 18px rgba(0,128,105,.25);
  }

  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:99;padding:18px}
  .box{background:#fff;padding:14px;border-radius:14px;max-width:92%;width:min(420px,100%)}
  .box img{width:100%;border-radius:12px;display:block}

  .ratatata{margin-top:10px;font-size:20px;font-weight:950;letter-spacing:2px;text-align:center}
  .ratatata.shake{animation:shake .09s infinite alternate}
  @keyframes shake{from{transform:translateX(-2px)}to{transform:translateX(2px)}}

  .storm{position:fixed;inset:0;pointer-events:none;z-index:120}
  .emoji{position:absolute;font-size:28px;animation:fall 1.2s linear forwards;opacity:.95;filter:drop-shadow(0 4px 6px rgba(0,0,0,.25))}
  @keyframes fall{
    from{transform:translateY(-40px) rotate(0deg);opacity:0}
    10%{opacity:1}
    to{transform:translateY(calc(100vh + 60px)) rotate(220deg);opacity:0}
  }
  .chatimg{width:210px;border-radius:12px;cursor:pointer;display:block}
  .viewonce{border:1px dashed #aaa;border-radius:12px;padding:10px;cursor:pointer;background:#fff;font-weight:900;user-select:none}
</style>
</head>

<body>
<div class="toastWrap" id="toastWrap"></div>

<div class="app">
  <div class="header">
    <button class="back" id="backBtn" aria-label="Geri">‚Äπ</button>
    <div class="titlewrap">
      <img class="avatar" id="headerAvatar" src="avatar.jpg" alt="profil">
      <div class="ttext">
        <div class="name" id="headerName">Sohbetler</div>
        <div class="status" id="headerStatus">WhatsApp gibi üòè</div>
      </div>
    </div>
  </div>

  <div class="screen active" id="listScreen">
    <div class="list" id="chatList"></div>
  </div>

  <div class="screen" id="chatScreen">
    <div class="chatArea">
      <div class="chat" id="chat"></div>
      <div class="chips" id="chips"></div>
      <div class="inputBar">
        <button class="roundBtn" id="plusBtn" title="Ekle">Ôºã</button>
        <div class="composer">
          <input id="msgInput" placeholder="Mesaj" autocomplete="off" />
        </div>
        <button class="send" id="sendBtn" title="G√∂nder">‚û§</button>
      </div>
    </div>
  </div>
</div>

<script>
  // ===== Main list (Hatce/Oe1 chats removed)
  const chats = [
    { id:"fatik",  name:"Fatik",  avatar:"avatar.jpg", preview:"Hazƒ±rsan k√º√ß√ºk bir oyun var üòè", time:"≈üimdi" },
    { id:"sevval", name:"≈ûevval", avatar:"", preview:"a≈ükoooo", time:"15:02" },
    { id:"anne",   name:"Anneeeyyy", avatar:"", preview:"Fatih oƒülumu √ºzersen sana hakkƒ±mƒ± helal etmem..", time:"14:41" },
    { id:"kuyum",  name:"KUYUMCULAR DERNEƒûƒ∞", avatar:"", preview:"Kƒ±rƒ±mlƒ± kuyumculuktan rekor satƒ±≈ü tebrik ederiz...", time:"13:12" },
    { id:"asros",  name:"Asro≈ü≈ü≈ü≈ü", avatar:"", preview:"Abla Toktikten video attƒ±m izleseneee", time:"12:27" },
    { id:"oe2",    name:"Oe2",    avatar:"", preview:"Fatih abime saygƒ±lar", time:"18:22" },
    { id:"oe3",    name:"Oe3",    avatar:"", preview:"Ben ORUL ORULLLL......", time:"17:58" },
    { id:"azra",   name:"Azra",   avatar:"", preview:"Yaro≈ü≈ü≈ü≈ü napƒ±yon kƒ±z", time:"17:40" },
  ];

  // ===== DOM
  const $ = (id)=>document.getElementById(id);
  const listScreen = $("listScreen");
  const chatScreen = $("chatScreen");
  const chatList = $("chatList");
  const chatBox = $("chat");
  const chips = $("chips");
  const backBtn = $("backBtn");
  const headerName = $("headerName");
  const headerStatus = $("headerStatus");
  const headerAvatar = $("headerAvatar");
  const toastWrap = $("toastWrap");
  const msgInput = $("msgInput");
  const sendBtn = $("sendBtn");
  const plusBtn = $("plusBtn");

  let currentChatId = null;

  // ===== helpers
  const escapeHtml = (s)=>String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;");
  const nowHHMM = ()=> {
    const d=new Date();
    return String(d.getHours()).padStart(2,"0")+":"+String(d.getMinutes()).padStart(2,"0");
  };

  // ===== audio + vibration
  let audioCtx=null, audioUnlocked=false;
  function unlockAudio(){
    if(audioUnlocked) return;
    try{
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if(audioCtx.state==="suspended") audioCtx.resume();
      audioUnlocked=true;
    }catch(e){}
  }
  function buzz(){
    try{ if(navigator.vibrate) navigator.vibrate([60,40,60]); }catch(e){}
  }
  function playMessageTone(){
    if(!audioUnlocked || !audioCtx) return;
    const now = audioCtx.currentTime + 0.02;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type="sine";
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    gain.gain.setValueAtTime(0.0001, now);

    function beep(t,f){
      osc.frequency.setValueAtTime(f,t);
      gain.gain.setValueAtTime(0.0001,t);
      gain.gain.exponentialRampToValueAtTime(0.18,t+0.01);
      gain.gain.exponentialRampToValueAtTime(0.0001,t+0.12);
    }
    beep(now, 880);
    beep(now+0.16, 660);

    osc.start(now);
    osc.stop(now+0.35);
    osc.onended=()=>{ try{osc.disconnect();gain.disconnect();}catch(e){} };
  }
  function playHeartbeat(durationMs=2600){
    if(!audioUnlocked || !audioCtx) return;
    const startAt = audioCtx.currentTime + 0.02;
    const endAt = startAt + durationMs/1000;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type="sine";
    osc.frequency.setValueAtTime(85,startAt);
    gain.gain.setValueAtTime(0.0001,startAt);
    osc.connect(gain); gain.connect(audioCtx.destination);

    function thump(t,str){
      gain.gain.setValueAtTime(0.0001,t);
      gain.gain.exponentialRampToValueAtTime(Math.max(0.001,str), t+0.015);
      gain.gain.exponentialRampToValueAtTime(0.0001, t+0.18);
      osc.frequency.setValueAtTime(95,t);
      osc.frequency.exponentialRampToValueAtTime(70, t+0.12);
      osc.frequency.exponentialRampToValueAtTime(85, t+0.18);
    }
    let t=startAt;
    while(t<endAt){
      thump(t,0.18);
      thump(t+0.22,0.12);
      t+=0.95;
    }
    osc.start(startAt);
    osc.stop(endAt+0.05);
    osc.onended=()=>{ try{osc.disconnect();gain.disconnect();}catch(e){} };
  }

  // ===== toast
  function showToast(sender, message){
    buzz(); playMessageTone();
    const t=document.createElement("div");
    t.className="toast";
    t.innerHTML=`
      <div class="toastTop">
        <div class="appname"><span class="waIcon">W</span> WhatsApp</div>
        <div>≈ûimdi</div>
      </div>
      <div class="toastMain">
        <div class="toastAva">${escapeHtml(sender).slice(0,1).toUpperCase()}</div>
        <div class="toastMeta">
          <div class="toastName">${escapeHtml(sender)}</div>
          <div class="toastMsg">${escapeHtml(message)}</div>
        </div>
      </div>
    `;
    toastWrap.appendChild(t);
    setTimeout(()=>{ t.classList.add("out"); setTimeout(()=>t.remove(),260); }, 3000);
  }

  // ===== header status
  function setStatus(text){ headerStatus.textContent=text; }
  function setOnline(){ setStatus("√ßevrimi√ßi"); }
  function setTyping(){ setStatus("yazƒ±yor‚Ä¶"); }

  // ===== ticks
  function ticksMarkup(state){
    if(state==="sent") return `<span>‚úì</span>`;
    if(state==="delivered") return `<span>‚úì</span><span>‚úì</span>`;
    if(state==="read") return `<span>‚úì</span><span>‚úì</span>`;
    return "";
  }
  function setTicks(bubbleEl, state){
    const t = bubbleEl.querySelector(".ticks");
    if(!t) return;
    t.classList.toggle("read", state==="read");
    t.innerHTML = ticksMarkup(state);
  }

  // ===== feature 4: dynamic preview
  function updatePreview(chatId, text){
    const c = chats.find(x=>x.id===chatId);
    if(!c) return;
    c.preview = text;

    const row = document.querySelector(`.row[data-id="${CSS.escape(chatId)}"]`);
    if(row){
      const prev = row.querySelector(".prev");
      if(prev) prev.textContent = text;
    }
  }

  // ===== bubble render
  function addBubble(who, html, {time=nowHHMM(), ticks=null} = {}){
    const d=document.createElement("div");
    d.className="bubble "+(who==="me"?"me":"you");
    d.innerHTML=`
      <div class="content">${html}</div>
      <div class="metaLine">
        <span class="timeTxt">${escapeHtml(time)}</span>
        ${ticks ? `<span class="ticks ${ticks==="read"?"read":""}">${ticksMarkup(ticks)}</span>` : ``}
      </div>
    `;
    chatBox.appendChild(d);
    chatBox.scrollTop = chatBox.scrollHeight;
    return d;
  }

  function addMeMessage(text){
    const safe = escapeHtml(text);
    if(currentChatId==="fatik"){
      updatePreview("fatik", text.length>40 ? text.slice(0,40)+"‚Ä¶" : text);
    }
    const b = addBubble("me", safe, { ticks:"sent" });
    setTimeout(()=> setTicks(b, "delivered"), 700);
    setTimeout(()=> setTicks(b, "read"), 1600);
    return b;
  }

  function typingThenIncoming(text, cb){
    setTyping();
    const t = addBubble("you", "yazƒ±yor...", {});
    t.style.opacity = .6;
    setTimeout(()=>{
      t.remove();
      buzz(); playMessageTone();
      addBubble("you", escapeHtml(text));
      if(currentChatId==="fatik"){
        updatePreview("fatik", text.length>40 ? text.slice(0,40)+"‚Ä¶" : text);
      }
      setOnline();
      cb && cb();
    }, 1100);
  }

  // ===== chips
  function setChips(btns){
    chips.innerHTML="";
    btns.forEach(b=>{
      const el=document.createElement("button");
      el.className="chip "+(b.variant||"");
      el.textContent=b.label;
      el.onclick=()=>{ unlockAudio(); b.onClick(); };
      chips.appendChild(el);
    });
  }
  function clearChips(){ chips.innerHTML=""; }

  // ===== image overlay
  function openImage(src){
    const o=document.createElement("div");
    o.className="overlay";
    o.innerHTML=`<div class="box"><img src="${src}" alt="img"></div>`;
    o.onclick=()=>o.remove();
    document.body.appendChild(o);
  }

  // ===== emoji storms
  function emojiStorm(emojis, count=60, fromTop=true){
    const storm=document.createElement("div");
    storm.className="storm";
    document.body.appendChild(storm);
    for(let i=0;i<count;i++){
      const e=document.createElement("div");
      e.className="emoji";
      e.textContent=emojis[Math.floor(Math.random()*emojis.length)];
      e.style.left=Math.random()*100+"vw";
      e.style.top= fromTop ? (-Math.random()*30)+"vh" : (50+Math.random()*30)+"vh";
      e.style.animationDelay=(Math.random()*0.35)+"s";
      e.style.fontSize=(22+Math.random()*18)+"px";
      storm.appendChild(e);
    }
    setTimeout(()=>storm.remove(),1500);
  }
  const angryStorm=()=>emojiStorm(["üò°","ü§¨","üò§","üëø","üí¢"],65,true);
  const kissStorm=()=>emojiStorm(["üíã","üòò","üíñ","üòç"],55,false);

  // ===== secret photo (naughty only)
  let secretViewed=false;
  function askPassword(){
    if(secretViewed) return;
    const o=document.createElement("div");
    o.className="overlay";
    o.innerHTML=`
      <div class="box" onclick="event.stopPropagation()">
        <p style="margin:0 0 10px 0;font-weight:900;">≈ûifreyi gir üòå</p>
        <input id="pw" style="width:100%;padding:10px;border-radius:10px;border:1px solid #ccc;outline:none" placeholder="≈ûifre">
        <button id="openBtn" style="margin-top:10px;padding:10px 16px;border:none;border-radius:999px;background:#25d366;color:#fff;font-weight:950;cursor:pointer;width:100%">A√ß</button>
        <div style="margin-top:8px;font-size:12px;opacity:.7">≈ûifre: <b>iamallyours</b></div>
      </div>
    `;
    document.body.appendChild(o);
    o.onclick=()=>o.remove();
    unlockAudio();
    o.querySelector("#openBtn").onclick=()=>checkPw(o);
    o.querySelector("#pw").addEventListener("keydown",(e)=>{ if(e.key==="Enter") checkPw(o); });
    o.querySelector("#pw").focus();
  }
  function checkPw(overlayEl){
    const v=(overlayEl.querySelector("#pw").value||"").trim().toLowerCase();
    if(v==="iamallyours"){
      secretViewed=true;
      overlayEl.remove();
      showSecret();
    }else{
      const inp=overlayEl.querySelector("#pw");
      inp.value=""; inp.style.borderColor="#e74c3c";
      inp.placeholder="Yanlƒ±≈ü‚Ä¶ tekrar dene üòè"; inp.focus();
    }
  }
  function animateText(el, text){
    el.textContent=""; let i=0;
    const t=setInterval(()=>{ el.textContent+=text[i++]; if(i>=text.length) clearInterval(t); }, 65);
  }
  function showSecret(){
    const o=document.createElement("div");
    o.className="overlay";
    o.innerHTML=`
      <div class="box" onclick="event.stopPropagation()">
        <img src="secret.jpg" alt="secret">
        <div class="ratatata shake" id="ratatata"></div>
      </div>
    `;
    document.body.appendChild(o);
    o.onclick=()=>o.remove();
    animateText(o.querySelector("#ratatata"), "RATATATATATA");
  }

  // ===== ‚ÄúHatce + Oe1‚Äù as timed toasts when entering Fatik
  let fatikNotifsScheduled=false;
  function scheduleFatikNotifs(){
    if(fatikNotifsScheduled) return;
    fatikNotifsScheduled=true;
    setTimeout(()=> showToast("Hatce","Kanka bedoylayƒ±m sonra bulu≈üalƒ±m."), 5000);
    setTimeout(()=> showToast("Oe1","Fatih abim kraldƒ±r"), 15000);
  }

  // ===== feature 11: ‚Äúbaskƒ±n‚Äù only from Asro≈ü≈ü≈ü≈ü + Azra
  let baskinDone=false;
  function triggerRandomBaskin(){
    if(baskinDone) return;
    baskinDone=true;
    const pool = [
      { sender:"Asro≈ü≈ü≈ü≈ü", msg:"Abla Toktikten video attƒ±m izleseneee" },
      { sender:"Azra", msg:"Yaro≈ü≈ü≈ü≈ü napƒ±yon kƒ±z" }
    ];
    const pick = pool[Math.floor(Math.random()*pool.length)];
    showToast(pick.sender, pick.msg);

    setTimeout(()=>{
      if(currentChatId!=="fatik") return;
      typingThenIncoming("ya kim bunlar ya üòÇ", ()=>{});
    }, 1400);
  }

  // ===== game
  let naughty=false;

  function startFatikChat(){
    unlockAudio();
    currentChatId="fatik";
    chatBox.innerHTML="";
    clearChips();
    secretViewed=false;
    naughty=false;

    showChatHeader("Fatik", "avatar.jpg");
    setOnline();

    scheduleFatikNotifs();

    // schedule ‚Äúbaskƒ±n‚Äù once (8-18 seconds)
    const delay = 8000 + Math.floor(Math.random()*10000);
    setTimeout(triggerRandomBaskin, delay);

    typingThenIncoming("Hazƒ±rsan k√º√ß√ºk bir oyun var üòè", ()=>{
      setChips([
        { label:"Normal oyun", onClick:()=>{ addMeMessage("Normal oyun"); normalStart(); } },
        { label:"Yaramaz oyun üòà", variant:"danger", onClick:()=>{ addMeMessage("Yaramaz oyun üòà"); naughtyStart(); } },
      ]);
    });
  }

  function normalStart(){
    typingThenIncoming("≈ûuna teyzeye elinde olsa ne yapmak isterdin askim?", ()=>{
      setChips([
        {
          label:"Onu lafla daƒüƒ±tƒ±rdƒ±m, ama tatlƒ± tatlƒ± üòá",
          onClick:()=>{
            addMeMessage("Onu lafla daƒüƒ±tƒ±rdƒ±m, ama tatlƒ± tatlƒ± üòá");
            typingThenIncoming("ben pek tatlƒ± tatlƒ± yapacaƒüƒ±nƒ± sanmƒ±yorum askim ama...", ()=> normalAfterQ1());
          }
        },
        {
          label:"ƒ∞≈üitme cihazƒ±yla ≈üaka yapardƒ±m: ‚ÄúTeyze sesimi a√ß!‚Äù üòÖ",
          onClick:()=>{
            addMeMessage("ƒ∞≈üitme cihazƒ±yla ≈üaka yapardƒ±m: ‚ÄúTeyze sesimi a√ß!‚Äù üòÖ");
            typingThenIncoming("asdjklaskdlna askim komik kƒ±zsƒ±n ke≈üke g√ºzel de olsan hihihihi", ()=> normalAfterQ1());
          }
        }
      ]);
    });
  }

  function normalAfterQ1(){
    clearChips();
    setTimeout(()=>{
      typingThenIncoming("OHA ASKƒ∞M ... KADIN 65 YA≈ûINDA NEMƒ∞≈û BUUU (biliyorum onu sevdiƒüini) ...", ()=>{
        setTimeout(()=>{
          typingThenIncoming("Neyse pekiii neden bug√ºn beni sevmedin ??", ()=>{
            setChips([
              {
                label:"Yoruldum askim ya",
                onClick:()=>{
                  addMeMessage("Yoruldum askim ya");
                  clearChips();
                  typingThenIncoming("Tamam hadi √∂yle olsun askim‚Ä¶ al o zaman sana bi foti üòå", ()=> sendNormalPhotoPack());
                }
              },
              {
                label:"√á√ºnk√º k√º√ß√ºk bir bok par√ßasƒ±sƒ±n sevmiyorum seni.",
                variant:"danger",
                onClick:()=>{
                  addMeMessage("√á√ºnk√º k√º√ß√ºk bir bok par√ßasƒ±sƒ±n sevmiyorum seni.");
                  clearChips();
                  buzz(); playMessageTone();
                  addBubble("you", "Senin aƒüzƒ±na sƒ±√ßarƒ±m Yaren..");
                  updatePreview("fatik", "Senin aƒüzƒ±na sƒ±√ßarƒ±m Yaren..");
                  angryStorm();

                  setTimeout(()=>{
                    buzz(); playMessageTone();
                    addBubble("you","Neyse gel bi √∂peyim de barƒ±≈üalƒ±m üòå");
                    updatePreview("fatik", "Neyse gel bi √∂peyim de barƒ±≈üalƒ±m üòå");
                    setTimeout(()=>{
                      addMeMessage("Yeeeeyyyy l√ºtfen hadi üòç");
                      setTimeout(()=> sendNormalPhotoPack(), 900);
                    }, 900);
                  }, 1200);
                }
              }
            ]);
          });
        },650);
      });
    },250);
  }

  function sendNormalPhotoPack(){
    playHeartbeat(2600);
    buzz(); playMessageTone();
    addBubble("you", `<img class="chatimg" src="normal.jpg" alt="normal" onclick="openImage('normal.jpg')">`, {});
    updatePreview("fatik", "üì∑ Fotoƒüraf");
    kissStorm();
    clearChips();
  }

  function naughtyStart(){
    naughty=true;
    secretViewed=false;
    naughtyQ1();
  }

  function naughtyQ1(){
    typingThenIncoming("≈ûuan yanƒ±nda olsaydƒ±m ne yapardƒ±n?", ()=>{
      setChips([
        { label:"Kanguru gibi √ºst√ºne atlardƒ±m üòè", variant:"danger", onClick:()=>{
          addMeMessage("Kanguru gibi √ºst√ºne atlardƒ±m üòè");
          typingThenIncoming("mmmhh ke≈üke yanƒ±mda olsaydƒ±n...", ()=> setTimeout(naughtyQ2,700));
        }},
        { label:"Sana kocaman sarƒ±lƒ±rdƒ±m ü´∂", onClick:()=>{
          addMeMessage("Sana kocaman sarƒ±lƒ±rdƒ±m ü´∂");
          typingThenIncoming("mmmhh ke≈üke yanƒ±mda olsaydƒ±n...", ()=> setTimeout(naughtyQ2,700));
        }},
      ]);
    });
  }

  function naughtyQ2(){
    typingThenIncoming("Peki g√∂zlerinin i√ßine baksam ellerini sƒ±msƒ±kƒ± tutsam ne hissederdin?", ()=>{
      setChips([
        { label:"Kendimi tehlikede hissederdim üò¨", onClick:()=>{
          addMeMessage("Kendimi tehlikede hissederdim üò¨");
          typingThenIncoming("Nasƒ±l yaa g√∂r√º≈ümemiz gereken konular var ..", ()=> setTimeout(naughtyEnd,700));
        }},
        { label:"Kendimi sana teslim ederdim üòà", variant:"danger", onClick:()=>{
          addMeMessage("Kendimi sana teslim ederdim üòà");
          typingThenIncoming("Nasƒ±l yaa g√∂r√º≈ümemiz gereken konular var ..", ()=> setTimeout(naughtyEnd,700));
        }},
      ]);
    });
  }

  function naughtyEnd(){
    clearChips();
    typingThenIncoming("Bunu sadece sen g√∂rmelisin üòà", ()=>{
      addBubble("you", `<div class="viewonce" onclick="askPassword()">üëÅÔ∏è 1 kez g√∂r√ºnt√ºle</div>`);
      updatePreview("fatik", "üëÅÔ∏è 1 kez g√∂r√ºnt√ºle");
    });
  }

  // ===== AI-enabled typing (Fatik only)
  async function sendTyped(){
    unlockAudio();
    const txt = (msgInput.value || "").trim();
    if(!txt) return;
    msgInput.value="";

    addMeMessage(txt);

    if(currentChatId !== "fatik") return;

    setTyping();
    const typingBubble = addBubble("you", "yazƒ±yor...", {});
    typingBubble.style.opacity = .6;

    try{
      const r = await fetch("/.netlify/functions/chat", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({
          message: txt,
          mode: naughty ? "naughty" : "normal"
        })
      });

      const data = await r.json();
      const reply = (data.reply || "").trim() || "bi an afalladƒ±m üòÖ";

      typingBubble.remove();

      buzz(); playMessageTone();
      addBubble("you", escapeHtml(reply));
      updatePreview("fatik", reply.length > 40 ? reply.slice(0,40)+"‚Ä¶" : reply);
      setOnline();
    }catch(e){
      typingBubble.remove();
      addBubble("you", "internet gitti gibi‚Ä¶ üòÖ");
      setOnline();
    }
  }

  // ===== list navigation
  function showList(){
    currentChatId=null;
    listScreen.classList.add("active");
    chatScreen.classList.remove("active");
    backBtn.style.display="none";
    headerName.textContent="Sohbetler";
    headerAvatar.src="avatar.jpg";
    headerStatus.textContent="WhatsApp gibi üòè";
    chatBox.innerHTML="";
    clearChips();
  }
  function showChatHeader(name, avatar){
    backBtn.style.display="inline-grid";
    headerName.textContent=name;
    headerAvatar.src = avatar || "avatar.jpg";
  }
  function openSimpleChat(chatId){
    unlockAudio();
    currentChatId=chatId;
    const c = chats.find(x=>x.id===chatId);
    chatBox.innerHTML="";
    clearChips();
    showChatHeader(c.name, "avatar.jpg");
    setOnline();

    buzz(); playMessageTone();

    if(chatId==="anne"){
      addBubble("you","Fatih oƒülumu √ßok seviyorum canƒ±m damadƒ±m");
      addBubble("you", escapeHtml(c.preview));
      return;
    }
    addBubble("you", escapeHtml(c.preview || "‚Ä¶"));
  }

  function renderList(){
    chatList.innerHTML="";
    chats.forEach(c=>{
      const row=document.createElement("div");
      row.className="row";
      row.dataset.id = c.id;
      const hasAvatar=!!c.avatar;
      row.innerHTML=`
        <div class="ava">${hasAvatar ? `<img class="ava" src="${c.avatar}" alt="">` : escapeHtml(c.name).slice(0,1).toUpperCase()}</div>
        <div class="meta">
          <div class="rname">${escapeHtml(c.name)}</div>
          <div class="prev">${escapeHtml(c.preview || "")}</div>
        </div>
        <div class="time">${escapeHtml(c.time || "")}</div>
      `;
      const ava = row.querySelector(".ava");
      if(hasAvatar){
        ava.style.padding="0";
        ava.style.overflow="hidden";
        ava.style.background="transparent";
      }
      row.onclick=()=>{
        listScreen.classList.remove("active");
        chatScreen.classList.add("active");
        if(c.id==="fatik") startFatikChat();
        else openSimpleChat(c.id);
      };
      chatList.appendChild(row);
    });
  }

  // ===== events
  backBtn.onclick=showList;
  sendBtn.onclick=sendTyped;
  msgInput.addEventListener("keydown",(e)=>{ if(e.key==="Enter"){ e.preventDefault(); sendTyped(); }});
  plusBtn.onclick=()=>{ unlockAudio(); showToast("WhatsApp", "Ekle butonu kapalƒ± üòÑ"); };

  window.openImage = openImage;
  window.askPassword = askPassword;

  renderList();
  showList();
</script>
</body>
</html>


